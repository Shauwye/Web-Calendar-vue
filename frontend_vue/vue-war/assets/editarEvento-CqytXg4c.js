import{N as U,r as D,P as k,Q as x,u as N,c as m,f as l,b as t,l as s,p as F,F as S,q as C,o as p,e as $,x as A}from"./index-BhvkWihw.js";import{C as V,s as I,a as O,b as v}from"./index-Dw5zaNAR.js";import{s as c,a as P,b as j,c as z,d as B}from"./fileupload.esm-BIg2ACDN.js";import{N as J}from"./navbar-BddOjjFQ.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";var q=Symbol();function H(){var y=U(q);if(!y)throw new Error("No PrimeVue Toast provided!");return y}const M={class:"page-layout"},R={class:"create-page"},_={class:"create-container"},G={class:"create-form"},K={class:"form-group"},Q={class:"form-row"},W={class:"form-group"},X={class:"form-group"},Y={class:"form-row"},Z={class:"form-group"},ee={class:"form-group"},te={class:"form-group checkbox-group"},oe={class:"form-group"},ae={class:"form-group"},le={class:"form-group"},re={class:"form-group"},se={key:0,class:"existing-attachments"},ie={class:"form-group actions"},E="antonella",ne={__name:"editarEvento",setup(y){const n=H(),g=x(),f=N(),o=D({id:"",title:"",startDate:null,startTime:null,endDate:null,endTime:null,allDay:!1,description:"",color:"#4361ee"}),u=D([]),d=D([]);k(async()=>{try{const i=await fetch(`http://localhost:8080/evento/${g.params.id}`);if(i.ok){const e=await i.json(),a=V.AES.decrypt(e,E),r=JSON.parse(a.toString(V.enc.Utf8));o.value={id:r.id,title:r.title,startDate:new Date(r.startDate),startTime:r.startTime,endDate:new Date(r.endDate),endTime:r.endTime,allDay:r.allDay,description:r.description,color:r.color},u.value=r.invitedUsers||[],d.value=r.attachments||[]}else throw new Error("Evento no encontrado")}catch{n.add({severity:"error",summary:"Error",detail:"No se pudo cargar el evento",life:3e3}),f.push("/")}});const b=async()=>{const i={id:o.value.id,title:o.value.title,startDate:o.value.startDate,startTime:o.value.startTime,endDate:o.value.endDate,endTime:o.value.endTime,allDay:o.value.allDay,description:o.value.description,color:o.value.color,invitedUsers:u.value,attachments:d.value},e=V.AES.encrypt(JSON.stringify(i),E).toString();try{if((await fetch("http://localhost:8080/actualizar",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedData:e})})).ok)n.add({severity:"success",summary:"Éxito",detail:"Evento actualizado correctamente",life:3e3}),f.push("/");else throw new Error("Error al actualizar")}catch{n.add({severity:"error",summary:"Error",detail:"No se pudo actualizar el evento",life:3e3})}},T=()=>{confirm("¿Estás seguro de que deseas eliminar este evento?")&&w()},w=async()=>{try{if((await fetch(`http://localhost:8080/eliminar/${o.value.id}`,{method:"DELETE"})).ok)n.add({severity:"success",summary:"Éxito",detail:"Evento eliminado correctamente",life:3e3}),f.push("/");else throw new Error("Error al eliminar");const e=()=>{}}catch{n.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el evento",life:3e3})}},h=i=>{d.value.splice(i,1)};return(i,e)=>(p(),m("div",M,[l(J),t("div",R,[t("div",_,[e[22]||(e[22]=t("h2",null,"Editar Evento",-1)),t("form",G,[t("div",K,[e[10]||(e[10]=t("label",{for:"title"},"Título del Evento",-1)),l(s(I),{id:"title",modelValue:o.value.title,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.title=a)},null,8,["modelValue"])]),t("div",Q,[t("div",W,[e[11]||(e[11]=t("label",null,"Fecha de Inicio",-1)),l(s(c),{modelValue:o.value.startDate,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.startDate=a),dateFormat:"yy-mm-dd",showIcon:""},null,8,["modelValue"])]),t("div",X,[e[12]||(e[12]=t("label",null,"Hora de Inicio",-1)),l(s(c),{modelValue:o.value.startTime,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.startTime=a),timeOnly:"",hourFormat:"24"},null,8,["modelValue"])])]),t("div",Y,[t("div",Z,[e[13]||(e[13]=t("label",null,"Fecha de Fin",-1)),l(s(c),{modelValue:o.value.endDate,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.endDate=a),dateFormat:"yy-mm-dd",showIcon:""},null,8,["modelValue"])]),t("div",ee,[e[14]||(e[14]=t("label",null,"Hora de Fin",-1)),l(s(c),{modelValue:o.value.endTime,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.endTime=a),timeOnly:"",hourFormat:"24"},null,8,["modelValue"])])]),t("div",te,[l(s(O),{modelValue:o.value.allDay,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.allDay=a),inputId:"allDay",binary:!0},null,8,["modelValue"]),e[15]||(e[15]=t("label",{for:"allDay"},"Todo el día",-1))]),t("div",oe,[e[16]||(e[16]=t("label",{for:"description"},"Descripción (Opcional)",-1)),l(s(P),{id:"description",modelValue:o.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.description=a),rows:"3"},null,8,["modelValue"])]),t("div",ae,[e[17]||(e[17]=t("label",{for:"color"},"Color del Evento",-1)),l(s(j),{modelValue:o.value.color,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.color=a),format:"hex"},null,8,["modelValue"])]),t("div",le,[e[18]||(e[18]=t("label",{for:"invitedUsers"},"Invitar Usuarios",-1)),l(s(z),{id:"invitedUsers",modelValue:u.value,"onUpdate:modelValue":e[8]||(e[8]=a=>u.value=a),separator:",",placeholder:"usuario@ejemplo.com"},null,8,["modelValue"])]),t("div",re,[e[20]||(e[20]=t("label",{for:"attachments"},"Archivos Adjuntos",-1)),l(s(B),{name:"attachments[]",url:"/api/upload",multiple:!0,accept:"image/*,.pdf,.doc,.docx",maxFileSize:1e6,chooseLabel:"Seleccionar archivos",class:"file-upload"}),e[21]||(e[21]=t("small",null,"Formatos permitidos: imágenes, PDF, Word (max 1MB)",-1)),d.value.length>0?(p(),m("div",se,[e[19]||(e[19]=t("h4",null,"Archivos existentes:",-1)),t("ul",null,[(p(!0),m(S,null,C(d.value,(a,r)=>(p(),m("li",{key:r},[$(A(a.name)+" ",1),l(s(v),{icon:"pi pi-times",severity:"danger",text:"",rounded:"","aria-label":"Eliminar",onClick:de=>h(r)},null,8,["onClick"])]))),128))])])):F("",!0)]),t("div",ie,[l(s(v),{label:"Cancelar",severity:"secondary",onClick:e[9]||(e[9]=a=>i.$router.back())}),l(s(v),{label:"Guardar Cambios",onClick:b}),l(s(v),{label:"Eliminar Evento",severity:"danger",onClick:T})])])])])]))}},ye=L(ne,[["__scopeId","data-v-555d76a1"]]);export{ye as default};
